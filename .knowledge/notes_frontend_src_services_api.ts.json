{"is_source_file": true, "format": "TypeScript", "description": "This file provides a service layer for managing notes, including CRUD operations, both via a backend API and localStorage fallback. It includes functions for listing, fetching, creating, updating, and deleting notes, and defines related data types and internal helper functions.", "external_files": ["localStorage", "fetch"], "external_methods": ["fetch"], "published": ["api", "getApiBase", "Note", "NoteCreate", "NoteUpdate"], "classes": [], "methods": [{"name": "listNotes", "description": "Fetches all notes, attempting a live API call and falling back to localStorage if necessary."}, {"name": "getNote", "description": "Retrieves a specific note by its id, with live API fallback."}, {"name": "createNote", "description": "Creates a new note, either via API or localStorage mock."}, {"name": "updateNote", "description": "Updates an existing note by id, with API or localStorage fallback."}, {"name": "deleteNote", "description": "Deletes a note by id, with API or localStorage fallback."}, {"name": "export function getApiBase(): string | null { getApiBase", "description": "Retrieves the API base URL from environment variables or window.", "scope": "", "scopeKind": ""}, {"name": "function genId() { genId", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function headersJson() { headersJson", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function normalize(list: Note[]): Note[] { normalize", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function readLocal(): Note[] { readLocal", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function seedInitial(): Note[] { seedInitial", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "async function tryLive<T>(fn: (base: string) => Promise<T>): Promise<{ ok: true; data: T } | { o/ tryLive", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "function writeLocal(notes: Note[]) { writeLocal", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["fetch", "tryLive", "headersJson", "readLocal", "writeLocal", "normalize", "genId"], "search-terms": ["notes_API_service", "localStorage fallback", "async CRUD operations", "Note data types", "API base URL configuration"], "state": 2, "file_id": 7, "knowledge_revision": 20, "git_revision": "", "revision_history": [{"15": ""}, {"19": ""}, {"20": ""}], "ctags": [{"_type": "tag", "name": "Note", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^export type Note = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NoteCreate", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^export type NoteCreate = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NoteUpdate", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^export type NoteUpdate = Partial<NoteCreate>;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "STORAGE_KEY", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^const STORAGE_KEY = 'notes_frontend__notes';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "api", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^export const api = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^  const base = getApiBase();$/", "language": "TypeScript", "kind": "constant", "scope": "tryLive", "scopeKind": "function"}, {"_type": "tag", "name": "candidates", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^  const candidates = [$/", "language": "TypeScript", "kind": "constant", "scope": "getApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^      content: payload.content ?? notes[idx].content,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const data = await fn(base);$/", "language": "TypeScript", "kind": "constant", "scope": "tryLive", "scopeKind": "function"}, {"_type": "tag", "name": "demo", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^  const demo: Note[] = [$/", "language": "TypeScript", "kind": "constant", "scope": "seedInitial", "scopeKind": "function"}, {"_type": "tag", "name": "env", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    env.PUBLIC_BACKEND_URL,$/", "language": "TypeScript", "kind": "constant", "scope": "getApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "env", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^  const env = (import.meta as unknown as { env?: EnvShape })?.env ?? {};$/", "language": "TypeScript", "kind": "constant", "scope": "getApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "genId", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^function genId() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getApiBase", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^export function getApiBase(): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "headersJson", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^function headersJson() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^      ...notes[idx],$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^      content: payload.content ?? notes[idx].content,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^      title: payload.title ?? notes[idx].title,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "idx", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const idx = notes.findIndex(n => n.id === id);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "listNotes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^  async listNotes(): Promise<Note[]> {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "live", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const live = await tryLive(async (base) => {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "normalize", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^function normalize(list: Note[]): Note[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "note", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const note: Note = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^      content: payload.content ?? notes[idx].content,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^      title: payload.title ?? notes[idx].title,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const notes = readLocal().filter(n => n.id !== id);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "notes", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const notes = readLocal();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const now = Date.now();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "now", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^  const now = Date.now();$/", "language": "TypeScript", "kind": "constant", "scope": "seedInitial", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const raw = localStorage.getItem(STORAGE_KEY);$/", "language": "TypeScript", "kind": "constant", "scope": "readLocal", "scopeKind": "function"}, {"_type": "tag", "name": "readLocal", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^function readLocal(): Note[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "seedInitial", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^function seedInitial(): Note[] {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^      title: payload.title ?? notes[idx].title,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "tryLive", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^async function tryLive<T>(fn: (base: string) => Promise<T>): Promise<{ ok: true; data: T } | { o/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    const updated: Note = {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "updatedAt", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^      updatedAt: now,$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "win", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^    win?.__API_BASE_URL__,$/", "language": "TypeScript", "kind": "constant", "scope": "getApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "win", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^  const win = typeof window !== 'undefined' ? (window as Window & { __API_BASE_URL__?: string })/", "language": "TypeScript", "kind": "constant", "scope": "getApiBase", "scopeKind": "function"}, {"_type": "tag", "name": "writeLocal", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-59231-59272/notes_frontend/src/services/api.ts", "pattern": "/^function writeLocal(notes: Note[]) {$/", "language": "TypeScript", "kind": "function"}], "hash": "ec8131256ab15ce3d2bd5288e08df1d7", "format-version": 4, "code-base-name": "notes_frontend", "filename": "notes_frontend/src/services/api.ts"}